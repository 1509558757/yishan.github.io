---
title: 设计模式之生产者消费者设计模式
date: 2021-01-13 13:02:40
tags: 
- java基础
- 设计模式
---
# 生产者与消费者设计模式

<!--more-->

#### 中间对象

```java
package com.yishan.test01;

/**
 * 中间对象
 * 生产者消费者 设计模式
 * @author : yishan
 * @date : 2021-01-13 11:26
 */
public class Desk {
    /**
     * 设置更新量
     */
    private boolean flag = false;

    /**
     * 统计次数
     */
    private  int count;

    /**
     * 创建同步锁
     */
    private  final Object lock = new Object();

    public Desk() {
        this(false,10);
    }

    public Desk(boolean flag, int count) {
        this.flag = flag;
        this.count = count;
    }

    public boolean isFlag() {
        return flag;
    }

    public void setFlag(boolean flag) {
        this.flag = flag;
    }

    public int getCount() {
        return count;
    }

    public void setCount(int count) {
        this.count = count;
    }

    public Object getLock() {
        return lock;
    }
}
```

#### 生产者

```java
package com.yishan.test01;

/**
 * 生产者
 * @author : yishan
 * @date : 2021-01-13 11:29
 */
public class Cooker extends Thread{
    private Desk desk;

    public Cooker(Desk desk) {
        this.desk = desk;
    }

    @Override
    public void run() {
        while (true){
            synchronized (desk.getLock()){
                if (desk.getCount()==0){
                    break ;
                }else{
                    if(!desk.isFlag()){
                        //具体操作
                        System.out.println("厨师正在生产面包！");
                        //更改
                        desk.setFlag(true);
                        //唤醒消费者线程
                        desk.getLock().notifyAll();
                    }else{
                        try {
                            //自己等待
                            desk.getLock().wait();
                        } catch (InterruptedException e) {
                            e.printStackTrace();
                        }
                    }
                }
            }
        }
    }
}
```

#### 消费者

```java
package com.yishan.test01;

/**
 * 消费者
 * @author : yishan
 * @date : 2021-01-13 11:33
 */
public class Foodie extends Thread {
    private Desk desk;

    public Foodie(Desk desk) {
        this.desk = desk;
    }

    @Override
    public void run() {
        while (true) {
            synchronized (desk.getLock()) {
                if (desk.getCount() == 0) {
                    break;
                } else {
                    if (desk.isFlag()) {
                        System.out.println("吃货在吃面包");
                        desk.setFlag(false);
                        desk.getLock().notifyAll();
                        desk.setCount(desk.getCount()-1);
                    }else{
                        try {
                            desk.getLock().wait();
                        } catch (InterruptedException e) {
                            e.printStackTrace();
                        }
                    }
                }
            }
        }
    }
}
```

#### 测试类

```java
package com.yishan.test01;

/**
 * 验证 生产者消费者 设计模式
 * @author : yishan
 * @date : 2021-01-13 11:38
 */
public class TestMain {
    public static void main(String[] args) {
        Desk desk = new Desk();

        Foodie foodie = new Foodie(desk);
        Cooker cooker = new Cooker(desk);

        foodie.start();
        cooker.start();
    }
}
```

